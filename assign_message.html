<p>[toc]</p>
<p>The AssignMessage policy is used in the request or response path to generate a new message or to modify an existing message. The message that is generated or modified can be used, for example, by a subsequent ServiceCallout policy as a request to a remote service or API.</p>
<p>AssignMessage is so named because the policy requires a message to be assigned as a variable. Select any variable and assign a message to it. You are defining the type of the variable, whether it is the request or the response. Specify whether you want to store the variable in the new message, or update the existing message.</p>

<p>AssignMessage is often used to generate the request message sent by a ServiceCallout policy to a remote HTTP service.</p>

<p>In the following example, the request message generated by the AssignMessage policy is assigned to a variable called <span style="font-family:courier new,courier,monospace;">partner.request</span>. The message generated is available to later policies or code executing in the flow, which can access the message through the variable.</p>
<pre>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;AssignMessage enabled="true" continueOnError="false" async="false" name="partnerRequest"&gt;
    &lt;IgnoreUnresolvedVariables&gt;false&lt;/IgnoreUnresolvedVariables&gt;
    &lt;AssignTo createNew="true" transport="http" type="request"&gt;partner.request&lt;/AssignTo&gt;
&lt;/AssignMessage&gt;</pre>

<p>The following AssignMessage policy creates a new request message, populated with the <code>user-agent</code> HTTP header from the source message, along with one query parameters derived from the source. Since the message generated by this policy is a request, the HTTP verb is also set to <code>GET</code>. </p>

<p><a href="https://github.com/apigee/api-platform-samples/tree/master/sample-proxies/policy-mashup">Working samples of the AssignMessage</a> policy are available in the <a href="https://github.com/apigee/api-platform-samples">API Platform samples</a>.</p>

<div id="well">&lt;pre&gt;&lt;AssignMessage name=&quot;GenerateRequest&quot;&gt;
  &lt;AssignTo createNew=&quot;true&quot; type=&quot;request&quot;&gt;Request&lt;/AssignTo&gt;
  &lt;Copy&gt;
	&lt;Headers&gt;
	  &lt;Header name=&quot;user-agent&quot;&gt;{request.header.user-agent}&lt;/QueryParam&gt;
	&lt;/Headers&gt;
  &lt;/Copy&gt;
  &lt;Set&gt;
    &lt;QueryParams&gt;
      &lt;QueryParam name=&quot;address&quot;&gt;{request.queryparam.address}&lt;/QueryParam&gt;
    &lt;/QueryParams&gt;
    &lt;Verb&gt;GET&lt;/Verb&gt;
  &lt;/Set&gt;
&lt;/AssignMessage&gt;</pre></div>

<p>Configure the AssignMessage policy using the following elements.</p>
<table border="0" cellpadding="1" cellspacing="1" class="table" style="width: 690px;">
	<thead>
		<tr>
			<th colspan="4">Field Name</th>
			<th>Description</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td colspan="4">AssignTo (<span style="color: rgb(169, 169, 169);">Optional</span>)</td>
			<td>
				<div>Specifies the variable to which the message will be assigned.</div>
				<ul>
					<li>If the <span style="font-family: courier new,courier,monospace;">&lt;AssignTo&gt;</span> element is missing, it is treated as <span style="font-family: courier new,courier,monospace;">&lt;AssignTo type="{decided based on flow to which the AssignMessage policy is attached: request or response}"/&gt;</span>.</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td colspan="2" rowspan="2">&nbsp;</td>
			<td colspan="2">createNew</td>
			<td>
				<div>If <span style="font-family:courier new,courier,monospace;">createNew</span> is set to <span style="font-family:courier new,courier,monospace;">true</span>, a new variable of the type specified in <span style="font-family: courier new,courier,monospace;">&lt;type&gt;</span> is created.</div>
				<div>If <span style="font-family:courier new,courier,monospace;">createNew</span> is set to <span style="font-family:courier new,courier,monospace;">false</span>, <span style="font-family: courier new,courier,monospace;">&lt;AssignTo&gt;</span> responds in one of two ways:</div>
				<ul>
					<li>If <span style="font-family: courier new,courier,monospace;">&lt;AssignTo&gt;</span> resolves to a message, it continues to the next flow.</li>
					<li>If <span style="font-family: courier new,courier,monospace;">&lt;AssignTo&gt;</span> cannot be resolved, or resolves to a non-message type, it fails to respond.</li>
				</ul>
				<div>If createNew is not specified, <span style="font-family: courier new,courier,monospace;">&lt;AssignTo&gt;</span> responds in one of two ways:</div>
				<ul>
					<li>If <span style="font-family: courier new,courier,monospace;">&lt;AssignTo&gt;</span> resolves to a message, it continues to the next flow.</li>
					<li>If <span style="font-family: courier new,courier,monospace;">&lt;AssignTo&gt;</span> cannot be resolved, or resolves to a non-message type, a new variable of type specified in <span style="font-family: courier new,courier,monospace;">&lt;type&gt;</span> is created.</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td colspan="2">type</td>
			<td>
				<div>Specifies the type of the variable.</div>
				<div>Valid values: request/response</div>
				<div>Default value: request</div>
			</td>
		</tr>
		<tr>
			<td colspan="4">IgnoreUnresolvedVariables (<span style="color: rgb(169, 169, 169);">Optional</span>)</td>
			<td>
				<div>If <span style="font-family:courier new,courier,monospace;">IgnoreUnresolvedVariables</span> is set to <span style="font-family:courier new,courier,monospace;">false</span> and any variable cannot be resolved, then the &nbsp;policy throws a fault.&nbsp;</div>
				<div>If it is set to <span style="font-family:courier new,courier,monospace;">true</span> and any variable is unresolvable, the variable is treated as empty string (<span style="font-family:courier new,courier,monospace;">Null</span>).</div>
				<div>Valid values: <span style="font-family:courier new,courier,monospace;">true/false</span></div>
				<div>Default value: <span style="font-family:courier new,courier,monospace;">false</span></div>
			</td>
		</tr>
		<tr>
			<td colspan="2" rowspan="10">Copy (<span style="color: rgb(169, 169, 169);">Optional</span>)</td>
			<td colspan="2" rowspan="1">source</td>
			<td>
				<div>Copies the specified information from the <span style="font-family: courier new,courier,monospace;">&lt;source&gt;</span> to the variable specified in the <span style="font-family: courier new,courier,monospace;">&lt;AssignTo&gt;</span> element.</div>
				<ul>
					<li>If the source is not specified, it is treated as a simple message.</li>
					<li>If the source variable can not be resolved, or resolves to a non-message type, <span style="font-family: courier new,courier,monospace;">&lt;Copy&gt;</span> fails to respond.</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td colspan="2">Headers</td>
			<td>Copies HTTP headers. To copy all headers, specify <span style="font-family: courier new,courier,monospace;">&lt;Copy&gt;&lt;Headers/&gt;&lt;/Copy&gt;</span>.&nbsp;</td>
		</tr>
		<tr>
			<td colspan="2">QueryParams</td>
			<td>Copies query parameters. Note that the QueryParams is copied only when both the source and AssignTo type are <em>request</em>.&nbsp;To copy all query parameters, specify&nbsp;<span style="font-family: 'courier new', courier, monospace;">&lt;Copy&gt;&lt;QueryParams/&gt;&lt;/Copy&gt;</span>.</td>
		</tr>
		<tr>
			<td colspan="2">FormParams</td>
			<td>Copies the form parameters. Note that the FormParams is copied only when the contentType is <code>source</code> and AssignTo is <code>application/x-www-form-urlencoded</code>.&nbsp;To copy all form parameters, specify&nbsp;<span style="font-family: 'courier new', courier, monospace;">&lt;Copy&gt;&lt;FormParams/&gt;&lt;/Copy&gt;</span>.</td>
		</tr>
		<tr>
			<td colspan="2">Payload</td>
			<td>Valid values: true/false. If true, the <code>Content-Type</code> header is copied.</td>
		</tr>
		<tr>
			<td colspan="2">Version</td>
			<td>Valid values: true/false. If true, the HTTP version is copied.</td>
		</tr>
		<tr>
			<td colspan="2">Verb</td>
			<td rowspan="2" style="vertical-align: middle;">Valid values: true/false. If true, it is assigned only when both the source and AssignTo type are <em>request</em>.</td>
		</tr>
		<tr>
			<td colspan="2">Path</td>
		</tr>
		<tr>
			<td colspan="2">StatusCode</td>
			<td rowspan="2" style="vertical-align: middle;">Valid values: true/false. If true, it is assigned only when both the source and AssignTo type are <em>response</em>.</td>
		</tr>
		<tr>
			<td colspan="2">ReasonPhrase</td>
		</tr>
		<tr>
			<td colspan="2" rowspan="4">Remove (<span style="color: rgb(169, 169, 169);">Optional</span>)</td>
			<td colspan="2">Headers</td>
			<td>Removes HTTP headers from the variable specified in the <span style="font-family: courier new,courier,monospace;">&lt;AssignTo&gt;</span> element. To remove all the headers, specify <span style="font-family: courier new,courier,monospace;">&lt;Remove&gt;&lt;Headers/&gt;&lt;/Remove&gt;</span>.&nbsp;</td>
		</tr>
		<tr>
			<td colspan="2">QueryParams</td>
			<td>Removes the query parameters. Note that the QueryParams are removed only when the AssignTo type is <em>request</em>.&nbsp;To copy all query paremeters, specify&nbsp;<span style="font-family: 'courier new', courier, monospace;">&lt;Copy&gt;&lt;QueryParams/&gt;&lt;/Copy&gt;</span>.</td>
		</tr>
		<tr>
			<td colspan="2">FormParams</td>
			<td>Removes the form parameters. Note that FormParams are removed only when the contentType of AssignTo is <em>application/x-www-form-urlencoded</em>.To copy all form parameters, specify&nbsp;<span style="font-family: 'courier new', courier, monospace;">&lt;Copy&gt;&lt;FormParams/&gt;&lt;/Copy&gt;</span>.</td>
		</tr>
		<tr>
			<td colspan="2">Payload</td>
			<td>Valid values: true/false. If true, the payload is cleared.</td>
		</tr>
		<tr>
			<td colspan="2" rowspan="3">Add (<span style="color: rgb(169, 169, 169);">Optional</span>)</td>
			<td colspan="2">Headers</td>
			<td>Adds the headers in the variable specified in the <span style="font-family: courier new,courier,monospace;">&lt;AssignTo&gt;</span> element. Note that the empty header <span style="font-family: courier new,courier,monospace;">&lt;Add&gt;&lt;Headers/&gt;&lt;/Add&gt;</span> does not add any header. The same holds true for QueryParams and FormParams.</td>
		</tr>
		<tr>
			<td colspan="2">QueryParams</td>
			<td>Adds the query parameters.</td>
		</tr>
		<tr>
			<td colspan="2">FormParams</td>
			<td>Adds the form parameters and the contentType of message is changed to <em>application/x-www-form-urlencoded</em>.</td>
		</tr>
		<tr>
			<td colspan="2" rowspan="10">Set (<span style="color: rgb(169, 169, 169);">Optional</span>)</td>
			<td colspan="2">Headers</td>
			<td>Sets/overwrites the HTTP headers in the variable specified in the <span style="font-family: courier new,courier,monospace;">&lt;AssignTo&gt;</span> element. Note that the empty header <span style="font-family: courier new,courier,monospace;">&lt;Set&gt;&lt;Headers/&gt;&lt;/Set&gt;</span> does not set any header. The same holds true for QueryParams and FormParams.</td>
		</tr>
		<tr>
			<td colspan="2">QueryParams</td>
			<td>Sets/overwrites the query parameters.</td>
		</tr>
		<tr>
			<td colspan="2">FormParams</td>
			<td>Sets/overwrites the form parameters and the contentType of message changes to <code>application/x-www-form-urlencoded</code>.</td>
		</tr>
		<tr>
			<td colspan="2">Payload</td>
			<td>You are allowed to set mixed payload contents. For example, <span style="font-family: courier new,courier,monospace;">&lt;root1&gt;sunday&lt;/root1&gt;&lt;root2&gt;funday&lt;/root2&gt;&lt;root3&gt;{var1}&lt;/root3&gt;</span>.</td>
		</tr>
		<tr>
			<td>&nbsp;</td>
			<td>contentType</td>
			<td>If contentType is specified, its value is treated as message template, and assigned to the contentType header.</td>
		</tr>
		<tr>
			<td colspan="2">Version</td>
			<td>Sets the version. Note that the content of <span style="font-family: courier new,courier,monospace;">&lt;Version&gt;</span> is treated as message template. The same holds true for Verb, Path, StatusCode, and ReasonPhrase.</td>
		</tr>
		<tr>
			<td colspan="2">Verb</td>
			<td rowspan="2" style="vertical-align: middle;">Sets the HTTP verb and path only when AssignTo type is <code>request</code>.</td>
		</tr>
		<tr>
			<td colspan="2">Path</td>
		</tr>
		<tr>
			<td colspan="2">StatusCode</td>
			<td rowspan="2" style="vertical-align: middle;">Sets the status code and reason phrase only when AssignTo type is <code>response</code>.</td>
		</tr>
		<tr>
			<td colspan="2">ReasonPhrase</td>
		</tr>
		<tr>
			<td colspan="2" rowspan="3">AssignVariable (<span style="color: rgb(169, 169, 169);">Optional</span>)</td>
			<td colspan="2">Name</td>
			<td style="vertical-align: middle;">Specifies the name of the variable.</td>
		</tr>
		<tr>
			<td colspan="2">Ref</td>
			<td style="vertical-align: middle;">Reference that assigns value to the variable.</td>
		</tr>
		<tr>
			<td colspan="2">Value</td>
			<td style="vertical-align: middle;">If <span style="font-family:courier new,courier,monospace;">&lt;Ref&gt;</span> is not specified or is unresolvable, this value is assigned to the variable.</td>
		</tr>
	</tbody>
</table>
<h2><a class="jumplink" name="schema"></a>Policy schema</h2>
<p>Each policy must conform to a policy schema. All policy constructs such as elements and attributes mentioned above are defined in a schema. To download the schema, <a href="/docs/download/file/fid/200">click here</a>.</p>
<h3>Example - AssignMessage policy</h3>
<p>[gist:3414852]</p>
